!function(a,b){function c(b,c,d,f){var h=(new Date).getTime();"function"==typeof c&&(d=c,c=null),c&&"string"!=typeof c&&JSON&&(c=JSON.stringify(c)),c=c?c.toString():null,k=f?"critical":"non critical";var i=new XMLHttpRequest,j=function(){return null===i.status||0===i.status||404===i.status?l():void e(c?c.length:0,h,function(){"function"==typeof d&&d(i.response,i.status,i),f&&a.dispatchEvent(g)},k,"success",i.status)},l=function(){e(c?c.length:0,h,function(){"function"==typeof d&&d(i.response,i.status,i)},k,"failure",i.status)};i.onload=j,i.onerror=l,i.open(null!==c?"POST":"GET",b);try{i.send(c||null)}catch(m){l()}}function d(a){null===l?b?b.getItem(j,function(b,c){l=c||[],"function"==typeof a&&a()}):(l=[],"function"==typeof a&&a()):"function"==typeof a&&a()}function e(a,c,d,e,f,g){var h=(new Date).getTime();i.getHistory(function(k){k.length>9999&&k.shift(),i.getNextID(function(i){return k.push({begin:c,end:h,size:a,origin:e,id:i,status:f,statusCode:g}),b?void b.setItem(j,k,d):void d()})})}var f="network-ready",g=new Event("critical-request-success"),h=[],i={},j="latencyStore",k="unknown",l=null;a.addEventListener(f,function(){for(var a=0;a<h.length;++a)c(h[a].Url,h[a].Data,h[a].Callback,!1);h=[]}),i.ajax=function(a,b,d){c(a,b,d,!0)},i.addNonCriticalRequest=function(a,b,c){h.push({Url:a,Data:b,Callback:c})},i.getPendingRequests=function(){return h},i.getLatestAccessTimeStamp=function(a,b){b=b||!1,i.getHistory(function(c){var d=null;if(null!==c&&c.length>0){var e=c.pop();if(e)if("success"===e.status||b)d=e.end;else{for(;e&&"undefined"!=typeof e.status&&"failure"===e.status;)e=c.pop();d="undefined"!=typeof e?e.end:null}}"function"==typeof a&&a(d)})},i.getNextID=function(a){i.getHistory(function(b){"function"==typeof a&&a(null!==b&&b.length>0?b[b.length-1].id+1||1:1)})},i.getHistory=function(a){d(function(){"function"==typeof a&&a(l)})},i.clearHistory=function(a){d(function(){l=[],b?b.clear(a):"function"==typeof a&&a()})},i.getAverageLatency=function(a,b,c){i.getHistory(function(d){for(var e=0,f=0,g=0,h=d.length;h>g;++g)(!a||a<d[g].begin)&&(!b||b>d[g].end)&&(++f,e+=d[g].end-d[g].begin);if("function"==typeof c)if(0!==f){var i=e/f;c(i)}else c(null)})},i.trimHistoryByDate=function(a,b,c){i.getHistory(function(d){var e=[];if(d&&d.length>0)for(var f=0;f<d.length;f++)d[f].end>b&&d[f].end<c&&e.push(d[f]);"function"==typeof a&&a(e)})},i.clearPendingRequests=function(){h=[]};var m="undefined"!=typeof a.AL?a.AL:null;a.AL=i,i.noConflict=function(){return m?a.AL=m:delete a.AL,i}}(this,"undefined"!=typeof localforage?localforage:null),function(a){function b(){a.dispatchEvent(g)}function c(e){a.clearTimeout(d),d=a.setTimeout(c,9e5),(i||e)&&j>.1&&b()}var d,e="network-ready",f="critical-request-success",g=new Event(e),h=a.navigator,i=!1,j=1;a.addEventListener(f,function(){c(!0)}),"undefined"!=typeof h.battery?(h.battery.onchargingchange=function(){i=h.battery.charging,c()},h.battery.onlevelchange=function(){j=h.battery.level}):"function"==typeof h.getBattery&&h.getBattery().then(function(a){a.onchargingchange=function(){i=a.charging,c()},a.onlevelchange=function(){j=a.level}})}(this);